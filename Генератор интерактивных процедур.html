<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>

body {
	font-family: tahoma, Arial;
    font-size: 15px;
    color: #333;
	margin: 0px;
    padding: 0px;
}

a {
    cursor: pointer
}


/*Стиль для выделения щелчком*/
.blue_withe {
    background-color: #74a3c7;
    color: #fff;

	padding: 7px;
	margin: 0px;
	text-align: left;

	display:table-block;

	cursor: pointer;
}

.head {
	width: 100%;
    background-color: #f7f7ff;
    text-align: center;
    padding-top: 5px;
    padding-bottom: 5px;
    font-weight: bold;
    display: flex;
    justify-content: center;
    align-items: center;
}

.left_column {
	width: 26%;
    float: left;
    overflow: hidden;
}

.right_column {
	float: left;
    width: 74%;
}

.right_column>div {
    display: block;
    border: 1px solid #dddfe0;
    border-left: none;
    border-right: none;
    margin-bottom: -1px;
    padding-left: 30px;
    position: relative;
}

.head_group_objection{
	background-color: #eaecee;
    padding: 7px;
    font-family: tahoma;
    text-align: center;
    position: relative;
}

.groups_objection{

}

.group_objection{
 	padding: 7px;
    cursor: pointer;
    position: relative;
}

.answer {
    position: relative;
    padding: 7px;
}


.objection{
 	padding: 7px;
    cursor: pointer;
 }

 .caption {
    color: #22a053;
    font-weight: bold;
}




.item {
    
    width: 100px;
    text-align: center;
}

.item_wrapper {
    display: flex;

}

.item_text {
    background-color: rgb(238, 238, 238);
}

.edit {
    background-color: rgb(240,190,180);

    box-shadow: inset 0 1px 5px 0px rgb(0, 0, 0, 0.8);
}

.icon-wrapper {
    position: absolute;
    margin: 0px;
    top: 0;
    right: 0;
}

.icon-pen, .icon-del {
    display: none;
    height: 30px;
    width: 30px;
    border-radius: 50%;
    opacity: 0.4;
    margin: 0px;
    right: 0;
    top: 0;
}

.icon-pen {
    right: 0px;
    background: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCIgdmlld0JveD0iMCAwIDUyOC44OTkgNTI4Ljg5OSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNTI4Ljg5OSA1MjguODk5OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnPgoJPHBhdGggZD0iTTMyOC44ODMsODkuMTI1bDEwNy41OSwxMDcuNTg5bC0yNzIuMzQsMjcyLjM0TDU2LjYwNCwzNjEuNDY1TDMyOC44ODMsODkuMTI1eiBNNTE4LjExMyw2My4xNzdsLTQ3Ljk4MS00Ny45ODEgICBjLTE4LjU0My0xOC41NDMtNDguNjUzLTE4LjU0My02Ny4yNTksMGwtNDUuOTYxLDQ1Ljk2MWwxMDcuNTksMTA3LjU5bDUzLjYxMS01My42MTEgICBDNTMyLjQ5NSwxMDAuNzUzLDUzMi40OTUsNzcuNTU5LDUxOC4xMTMsNjMuMTc3eiBNMC4zLDUxMi42OWMtMS45NTgsOC44MTIsNS45OTgsMTYuNzA4LDE0LjgxMSwxNC41NjVsMTE5Ljg5MS0yOS4wNjkgICBMMjcuNDczLDM5MC41OTdMMC4zLDUxMi42OXoiIGZpbGw9IiMwMDAwMDAiLz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8L3N2Zz4K)
                no-repeat   center;
}

.icon-del {
    right: 0px;
    background: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCIgdmlld0JveD0iMCAwIDM0OC4zMzMgMzQ4LjMzNCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMzQ4LjMzMyAzNDguMzM0OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnPgoJPHBhdGggZD0iTTMzNi41NTksNjguNjExTDIzMS4wMTYsMTc0LjE2NWwxMDUuNTQzLDEwNS41NDljMTUuNjk5LDE1LjcwNSwxNS42OTksNDEuMTQ1LDAsNTYuODUgICBjLTcuODQ0LDcuODQ0LTE4LjEyOCwxMS43NjktMjguNDA3LDExLjc2OWMtMTAuMjk2LDAtMjAuNTgxLTMuOTE5LTI4LjQxOS0xMS43NjlMMTc0LjE2NywyMzEuMDAzTDY4LjYwOSwzMzYuNTYzICAgYy03Ljg0Myw3Ljg0NC0xOC4xMjgsMTEuNzY5LTI4LjQxNiwxMS43NjljLTEwLjI4NSwwLTIwLjU2My0zLjkxOS0yOC40MTMtMTEuNzY5Yy0xNS42OTktMTUuNjk4LTE1LjY5OS00MS4xMzksMC01Ni44NSAgIGwxMDUuNTQtMTA1LjU0OUwxMS43NzQsNjguNjExYy0xNS42OTktMTUuNjk5LTE1LjY5OS00MS4xNDUsMC01Ni44NDRjMTUuNjk2LTE1LjY4Nyw0MS4xMjctMTUuNjg3LDU2LjgyOSwwbDEwNS41NjMsMTA1LjU1NCAgIEwyNzkuNzIxLDExLjc2N2MxNS43MDUtMTUuNjg3LDQxLjEzOS0xNS42ODcsNTYuODMyLDBDMzUyLjI1OCwyNy40NjYsMzUyLjI1OCw1Mi45MTIsMzM2LjU1OSw2OC42MTF6IiBmaWxsPSIjMDAwMDAwIi8+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg==)
                no-repeat   center;
}

.icon-pen:active, .icon-del:active {
    transform: translateY(2px);
}

.icon-pen:hover, .icon-del:hover {
    opacity: 1;
    background-color: #eaecee;
}

.group_objection:hover .icon-pen,
.group_objection:hover .icon-del,
.head_group_objection:hover .icon-del,
.head_group_objection:hover .icon-pen,
.answer:hover .icon-pen,
.answer:hover .icon-del {
    display: inline-block;
}

.plus-item{
    padding: 10px;
    border-radius: 0 0 5em 5em /0 0 3em 3em;
    background: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDQyIDQyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0MiA0MjsiIHhtbDpzcGFjZT0icHJlc2VydmUiIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiPgo8cGF0aCBkPSJNMzcuMDU5LDE2SDI2VjQuOTQxQzI2LDIuMjI0LDIzLjcxOCwwLDIxLDBzLTUsMi4yMjQtNSw0Ljk0MVYxNkg0Ljk0MUMyLjIyNCwxNiwwLDE4LjI4MiwwLDIxczIuMjI0LDUsNC45NDEsNUgxNnYxMS4wNTkgIEMxNiwzOS43NzYsMTguMjgyLDQyLDIxLDQyczUtMi4yMjQsNS00Ljk0MVYyNmgxMS4wNTlDMzkuNzc2LDI2LDQyLDIzLjcxOCw0MiwyMVMzOS43NzYsMTYsMzcuMDU5LDE2eiIgZmlsbD0iIzAwMDAwMCIvPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8L3N2Zz4K)
    no-repeat center  ;
    opacity: 0.6;
    margin: 1px;
    margin-bottom: 5px;
}

.plus-item:hover {
    background-color: #eaecee;
    opacity: 1;
}

.visible {
    display: block;
}

.invis {
    display: none
}

</style>
</head>

<body >
    <button><a download = "Процедура для редактирования.html" id = 'full'>Загрузить с возможностью редактирования</a></button>
    <button><a download = "Процедура для пользователя.html" id = 'light'>Загрузить для конечного пользователя</a></button>
 
    <!--Шапка файла-->
    <div class="head" data-edit="heading">
        Двойной клик для редактирования
    </div>

    <div class="left_column">
        
        <div><!--Главное меню-->
            <div class="groups_objection" data-hover = 'false'>

                <div id = 'first-hut' class="head_group_objection" data-hover = 'first-hut' data-cardcount="1">
                    Заголовок главного меню
                </div>

                <div class='plus-item'>
                </div>

                <div class="card-holder">
                </div>

            </div>
        </div>
        
         
    </div>

    <div class="right_column"><!--Правая часть файла для вывода содержимого пунктов-->
        <div id="area_answer"></div>
    </div>

<script>

//Клики
document.addEventListener('click', function(a) {
    let elem = a.toElement;

    //Клик по меню
    if (elem.dataset.click == 'item') {

        //Вызов карточки
        let cards = elem.parentNode.lastElementChild.children;
        for(i = 0; i < cards.length; i++) {
            cards[i].classList.add('invis');

            if (cards[i].firstElementChild.innerText == elem.innerText) {
                cards[i].classList.remove('invis');

                //Снимаем подсветку с пунктов
                let items = cards[i].children;
                for(j = 0; j < items.length; j++) {
                    items[j].classList.remove('blue_withe');
                }
            };
        };

        //Вызов ответа
        let answers = document.getElementById('area_answer').children;
        for(i = 0; i < answers.length; i++) {

            answers[i].classList.add('invis');

            if (answers[i].id == 'answer_' + elem.id) {
                answers[i].classList.remove('invis');
            };
        };

        //Подсветка пунктов
        let items = elem.parentNode.children;
        for(i = 0; i<items.length; i++) {
            items[i].classList.remove('blue_withe');
        };

        elem.classList.add('blue_withe');
    };

});
</script>

<script id = 'scriptForEdit'>
     //Сохранение файла на диск
document.querySelector('#full').addEventListener('click', function(){
    let contentFile = document.querySelector('html').innerHTML;
    this.href = 'data:application/html;charset=utf-8,' + encodeURIComponent(contentFile);
});

document.querySelector('#light').addEventListener('click', function(){

    let doc = document.createElement('div');
    doc.innerHTML = document.querySelector('html').innerHTML;
    let clonDoc = doc.cloneNode(true);

    let plus_items = clonDoc.querySelectorAll('.plus-item');
    let icons = clonDoc.querySelectorAll('.icon-wrapper');
    let buttons = clonDoc.querySelectorAll('button');
    let scriptForEdit = document.getElementById('scriptForEdit');

    for(i = 0; i < plus_items.length; i++) {
        plus_items[i].remove();
    };

    for(i = 0; i < icons.length; i++) {
        icons[i].remove();
    };

    for(i = 0; i < buttons.length; i++) {
        buttons[i].remove();
    };

    scriptForEdit.remove();

let bw = clonDoc.querySelectorAll('.blue_withe');
for(i = 0; i < bw.length; i++) {
    bw[i].classList.remove('blue_withe');
};

let cardHolders = clonDoc.querySelectorAll('.card-holder');
for(i = 0; i < cardHolders.length; i++) {
    let cards = cardHolders[i].children;
    for(j = 0; j < cards.length; j++) {
        cards[j].classList.add('invis');
    }
};
    this.href = 'data:application/html;charset=utf-8,' + encodeURIComponent(clonDoc.innerHTML);
});


//Режим редактирования заголовков после двойного клика
document.addEventListener('dblclick', function(a){
    let elem = a.toElement;
    if (elem.dataset.edit == 'heading'){
        elem.contentEditable = true;
        elem.classList.add('edit');
            
        //Отмена режима редактирования
        document.addEventListener('mousedown', function(b){
            if (b.toElement.contentEditable !== 'true'){
                elem.contentEditable = false;
                elem.classList.remove('edit');
            };
        });
    };
});

//Создаем кнопки редактирования и удаления
document.addEventListener('mouseover', function(a){
    let elem = a.toElement;
    
    //На пункте меню
    if (elem.dataset.hover == 'item'){

        if(elem.querySelector('.icon-wrapper') == null){

            let iconWrapper = document.createElement('div');
            iconWrapper.classList.add('icon-wrapper');
            elem.appendChild(iconWrapper);
            iconWrapper.contentEditable = false;

            let iconPen = document.createElement('div');
            iconPen.classList.add('icon-pen');
            iconPen.contentEditable = false;
            iconWrapper.appendChild(iconPen);

            let iconDel = document.createElement('div');
            iconDel.classList.add('icon-del');
            iconDel.contentEditable = false;
            iconWrapper.appendChild(iconDel);
        };
    };

    //На шапке меню (кнопка удаления)
    if (elem.dataset.hover == 'hut'){

            if(elem.querySelector('.icon-wrapper') == null){

                let iconWrapper = document.createElement('div');
                iconWrapper.classList.add('icon-wrapper');
                iconWrapper.contentEditable = false;
                elem.appendChild(iconWrapper);

                let iconDel = document.createElement('div');
                iconDel.classList.add('icon-del');
                iconDel.contentEditable = false;
                iconWrapper.appendChild(iconDel);
            };
    };

    //На шапке главного меню (кнопка редактирования)
    if (elem.dataset.hover == 'first-hut'){

            if(elem.querySelector('.icon-wrapper') == null){

                let iconWrapper = document.createElement('div');
                iconWrapper.classList.add('icon-wrapper');
                iconWrapper.contentEditable = false;
                elem.appendChild(iconWrapper);
                
                let iconEdit = document.createElement('div');
                iconEdit.classList.add('icon-pen');
                iconEdit.contentEditable = false;
                iconWrapper.appendChild(iconEdit);
            };
    };
});

//Клики
document.addEventListener('click', function(a) {
    let elem = a.toElement;

    //Режим редактирования
    if (elem.className == 'icon-pen'){
        let parent = elem.parentNode.parentNode;
        parent.contentEditable = true;
        parent.classList.add('edit');

        //Копируем текст из пункта меню в шапку карточки
        if (parent.dataset.click == 'item') {
            let cards = parent.parentNode.lastElementChild.children;
            for(i=0; i<cards.length; i++){

                if (cards[i].firstElementChild.innerText == parent.innerText) {

                    let trueHut = cards[i].firstElementChild;
                    parent.addEventListener('input', function(){
                        trueHut.innerText = parent.innerText;
                    });
                };
            };
        };

        //Отмена режима редактирования
        document.addEventListener('mousedown', function(b){
            
            if (b.toElement.contentEditable !== 'true'){
                
                parent.contentEditable = false;
                parent.classList.remove('edit');
            };
        });
    };

    //Удаление элементов меню
    if (elem.className == 'icon-del'){
        let parent = elem.parentNode.parentNode;

        //Удаление пункта меню и зависимой карточки
        if (parent.dataset.hover == 'item'){
            let cards = parent.parentNode.lastElementChild.children;

            for(i=0; i<cards.length; i++){

                if (cards[i].firstElementChild.innerText == parent.innerText) {
                    let delCard = cards[i];
                    delCard.remove();
                };
            };
            parent.remove();
        };

        //Удаление карточки
        if (parent.dataset.hover == 'hut'){
            parent.parentNode.remove();
        };
    };

    //Создание нового пункта, карточки и ответа
    if (elem.className == 'plus-item') {
        
        //Тело пункта
        let newItem = document.createElement('div');
        newItem.classList.add('group_objection');
        newItem.dataset.hover = 'item';
        newItem.dataset.click = 'item';
        let count = document.getElementById('first-hut').dataset.cardcount;
        newItem.id = 'item' + count;
        document.getElementById('first-hut').dataset.cardcount++;

        //Имя пункта
        newItem.innerText = "Новый пункт " + count;

        //Вставляем пункт
        elem.parentNode.insertBefore(newItem, elem);
        

        //Шапка новой карточки
        let newHut = document.createElement('div');
        newHut.classList.add('head_group_objection');
        newHut.innerText = newItem.innerText;
        newHut.dataset.hover = 'hut';

        //Прочие элементы карточки
        let newElem = elem.cloneNode(true);
        let newCardHolder = document.createElement('div');

        //Тело карточки и заполнение ее элементами
        let newCard = document.createElement('div');
        newCard.classList.add('invis');
        newCard.id = 'card_' + newItem.id;
        newCard.appendChild(newHut);
        newCard.appendChild(newElem);
        newCard.appendChild(newCardHolder);

        //Вставка карточки в стек
        elem.nextElementSibling.appendChild(newCard);


        //Ответ
        let newAnswer = document.createElement('div');
        newAnswer.classList.add('answer');
        newAnswer.classList.add('invis');
        newAnswer.innerText = 'Новый ответ ' + count;
        newAnswer.dataset.hover = 'item';
        newAnswer.id = 'answer_' + newItem.id;

        //Вставка ответа в стек
        document.getElementById('area_answer').appendChild(newAnswer);
    }
});
</script>
</body>

